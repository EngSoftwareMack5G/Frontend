<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perfil - MackLink</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900 flex flex-col min-h-screen">
  <header class="bg-gray-200 px-6 py-4 flex justify-center items-center border-b">
    <a href="home.html" class="text-xl font-semibold">MackLink</a>
  </header>

  <main class="flex justify-center items-center h-[70vh] px-6">
    <div class="bg-white p-8 rounded shadow max-w-md w-full text-center">
      <h2 class="text-2xl font-bold mb-4">Perfil do Usuário</h2>
      <p id="username" class="text-lg text-gray-700 mb-2">Carregando...</p>
      <p id="userType" class="text-sm text-gray-500">Carregando...</p>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const token = localStorage.getItem('token'); // Obtém o token do localStorage

      if (!token) {
        alert('Você precisa estar logado para acessar esta página.');
        window.location.href = 'login_option.html'; // Redireciona para a página de login
        return;
      }

      try {
        // Envia o token para o endpoint
        const response = await fetch('http://localhost:3002/auth/key', {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`, // Envia o token no cabeçalho
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) {
          throw new Error('Erro ao obter informações do usuário');
        }

        const data = await response.json(); // Obtém o JSON com o nome de usuário e tipo
        document.getElementById('username').textContent = `Usuário: ${data.username}`;
        document.getElementById('userType').textContent = `Tipo: ${data.type}`;
      } catch (error) {
        console.error('Erro ao conectar com o servidor:', error);
        alert('Erro ao carregar informações do perfil.');
      }
    });
  </script>
</body>
</html>